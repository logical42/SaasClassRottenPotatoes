/*
 *  Copyright 2011 Twitter, Inc.
 *  Licensed under the Apache License, Version 2.0 (the "License");
 *  you may not use this file except in compliance with the License.
 *  You may obtain a copy of the License at
 *
 *  http://www.apache.org/licenses/LICENSE-2.0
 *
 *  Unless required by applicable law or agreed to in writing, software
 *  distributed under the License is distributed on an "AS IS" BASIS,
 *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *  See the License for the specific language governing permissions and
 *  limitations under the License.
 */
var HoganTemplate=function(){function a(a){this.text=a}function b(a){var b=String(a===null?"":a);return h.test(b)?b.replace(c,"&amp;").replace(d,"&lt;").replace(e,"&gt;").replace(f,"&#39;").replace(g,"&quot;"):b}a.prototype={r:function(a,b){return""},v:b,render:function(a,b){return this.r(a,b)},rp:function(a,b,c,d){var e=c[a];return e?e.render(b,c):""},rs:function(a,b,c){var d="",e=a[a.length-1];if(!i(e))return d=c(a,b),d;for(var f=0;f<e.length;f++)a.push(e[f]),d+=c(a,b),a.pop();return d},s:function(a,b,c,d,e,f){if(i(a)&&a.length===0)return!1;!d&&typeof a=="function"&&(a=this.ls(a,b,c,e,f));var g=a===""||!!a;return!d&&g&&b&&b.push(typeof a=="object"?a:b[b.length-1]),g},d:function(a,b,c,d){if(a==="."&&i(b[b.length-2]))return b[b.length-1];var e=a.split("."),f=this.f(e[0],b,c,d),g=null;for(var h=1;h<e.length;h++)f&&typeof f=="object"&&e[h]in f?(g=f,f=f[e[h]]):f="";return d&&!f?!1:(!d&&typeof f=="function"&&(b.push(g),f=this.lv(f,b,c),b.pop()),f)},f:function(a,b,c,d){var e=!1,f=null,g=!1;for(var h=b.length-1;h>=0;h--){f=b[h];if(f&&typeof f=="object"&&a in f){e=f[a],g=!0;break}}return g?(!d&&typeof e=="function"&&(e=this.lv(e,b,c)),e):d?!1:""},ho:function(a,b,c,d){var e=a.call(b,d,function(a){return Hogan.compile(a).render(b)}),f=Hogan.compile(e.toString()).render(b,c);return this.b=f,!1},b:"",ls:function(a,b,c,d,e){var f=b[b.length-1];if(a.length>0)return this.ho(a,f,c,this.text.substring(d,e));var g=a.call(f);return typeof g=="function"?this.ho(g,f,c,this.text.substring(d,e)):g},lv:function(a,b,c){var d=b[b.length-1];return Hogan.compile(a.call(d).toString()).render(d,c)}};var c=/&/g,d=/</g,e=/>/g,f=/\'/g,g=/\"/g,h=/[&<>\"\']/,i=Array.isArray||function(a){return Object.prototype.toString.call(a)==="[object Array]"};return a}(),Hogan=function(){function a(a){function d(){n.length>0&&(o.push(new String(n)),n="")}function e(){var a=!0;for(var b=t;b<o.length;b++){a=o[b].tag&&r[o[b].tag]<r._v||!o[b].tag&&o[b].match(q)==null;if(!a)return!1}return a}function f(a,b){d();if(a&&e())for(var c=t;c<o.length;c++)o[c].tag||o.splice(c,1);else b||o.push({tag:"\n"});p=!1,t=o.length}function g(a,c){var d="="+v,e=a.indexOf(d,c),f=b(a.substring(a.indexOf("=",c)+1,e)).split(" ");return u=f[0],v=f[1],e+d.length-1}var h=a.length,i=0,j=1,k=2,l=i,m=null,n="",o=[],p=!1,s=0,t=0,u="{{",v="}}";for(s=0;s<h;s++)if(l==i)c(u,a,s)?(--s,d(),l=j):a[s]=="\n"?f(p):n+=a[s];else if(l==j){s+=u.length-1;var w=r[a[s+1]];m=w?a[s+1]:"_v",p=s,m=="="?(s=g(a,s),l=i):(w&&s++,l=k)}else c(v,a,s)?(s+=v.length-1,o.push({tag:m,n:b(n),i:m=="/"?p-1:s+1}),n="",l=i,m=="{"&&s++):n+=a[s];return f(p,!0),o}function b(a){return a.trim?a.trim():a.replace(/^\s*|\s*$/g,"")}function c(a,b,c){if(b[c]!=a[0])return!1;for(var d=1,e=a.length;d<e;d++)if(b[c+d]!=a[d])return!1;return!0}function d(a,b,c,g){var h=[],i=null,j=null;while(a.length>0){j=a.shift();if(j.tag=="#"||j.tag=="^"||e(j,g))c.push(j),j.nodes=d(a,j.tag,c,g),h.push(j);else{if(j.tag=="/"){if(c.length==0)throw new Error("Closing tag without opener: /"+j.n);i=c.pop();if(j.n!=i.n&&!f(j.n,i.n,g))throw new Error("Nesting error: "+i.n+" vs. "+j.n);return i.end=j.i,h}h.push(j)}}if(c.length>0)throw new Error("missing closing tag: "+c.pop().n);return h}function e(a,b){for(var c=0,d=b.length;c<d;c++)if(b[c].o==a.n)return a.tag="#",!0}function f(a,b,c){for(var d=0,e=c.length;d<e;d++)if(c[d].c==a&&c[d].o==b)return!0}function g(a,b,c){var d='var c = [cx];var b = "";var _ = this;'+j(a)+"return b;";if(c.asString)return"function(cx,p){"+d+";};";var e=new HoganTemplate(b);return e.r=new Function("cx","p",d),e}function h(a){return a.replace(v,"\\\\").replace(s,'\\"').replace(t,"\\n").replace(u,"\\r")}function i(a){return~a.indexOf(".")?"d":"f"}function j(a){var b="";for(var c=0,d=a.length;c<d;c++){var e=a[c].tag;e=="#"?b+=k(a[c].nodes,a[c].n,i(a[c].n),a[c].i,a[c].end):e=="^"?b+=l(a[c].nodes,a[c].n,i(a[c].n)):e=="<"||e==">"?b+=m(a[c].n):e=="{"||e=="&"?b+=n(a[c].n,i(a[c].n)):e=="\n"?b+=p("\n"):e=="_v"?b+=o(a[c].n,i(a[c].n)):e===undefined&&(b+=p(a[c]))}return b}function k(a,b,c,d,e){var f="if(_.s(_."+c+'("'+h(b)+'",c,p,1),';return f+="c,p,0,"+d+","+e+")){",f+="b += _.rs(c,p,",f+='function(c,p){ var b = "";',f+=j(a),f+="return b;});c.pop();}",f+='else{b += _.b; _.b = ""};',f}function l(a,b,c){var d="if (!_.s(_."+c+'("'+h(b)+'",c,p,1),c,p,1,0,0)){';return d+=j(a),d+="};",d}function m(a){return'b += _.rp("'+h(a)+'",c[c.length - 1],p);'}function n(a,b){return"b += (_."+b+'("'+h(a)+'",c,p,0));'}function o(a,b){return"b += (_.v(_."+b+'("'+h(a)+'",c,p,0)));'}function p(a){return'b += "'+h(a)+'";'}var q=/\S/,r={"#":1,"^":2,"/":3,"!":4,">":5,"<":6,"=":7,_v:8,"{":9,"&":10},s=/\"/g,t=/\n/g,u=/\r/g,v=/\\/g;return{scan:a,parse:function(a,b){return b=b||{},d(a,"",[],b.sectionTags||[])},cache:{},compile:function(b,c){c=c||{};var d=this.cache[b];return d?d:(d=g(this.parse(a(b),c),b,c),this.cache[b]=d)}}}();typeof module!="undefined"&&module.exports?(module.exports=Hogan,module.exports.Template=HoganTemplate):typeof exports!="undefined"&&(exports.Hogan=Hogan,exports.HoganTemplate=HoganTemplate)